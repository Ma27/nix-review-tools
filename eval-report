#!/usr/bin/env nix-shell

require File.join(__dir__(), "lib/hydra")
require File.join(__dir__(), "lib/report")

abort "Usage: eval-report <id...>" unless ARGV[0]

ids = [];

# TODO : arguments parsing...
ARGV.each do |arg|
  ids << arg
end

# Combine all evals
evals = ids.map { |id| [id, Hydra::Eval.get(id, with_build_details: true)] }.to_h

puts Report::Eval.report(evals)
puts Report::Eval.failure_propagation(evals)

#!nix-shell shell.nix -i ruby
# vim: set ft=ruby:
